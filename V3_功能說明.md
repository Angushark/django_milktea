# 奶茶尋 v3 功能說明

## 已完成的功能

### 1. 使用者認證系統
- **註冊新帳號**: `/register/`
  - 使用者可以建立新帳號
  - 包含使用者名稱和密碼驗證
  - 註冊成功後自動登入

- **登入**: `/login/`
  - 使用者名稱和密碼登入
  - 登入後可使用收藏功能

- **登出**: `/logout/`
  - 安全登出系統

- **密碼重設**: `/password-reset/`
  - 透過 Email 重設密碼
  - 開發環境使用 console backend（密碼重設連結會顯示在終端機）
  - 包含完整的重設流程（請求 → 確認 → 完成）

### 2. 個人收藏功能
- **收藏清單頁面**: `/favorites/`
  - 顯示所有收藏的店家和飲料
  - 可篩選顯示：全部 / 只顯示店家 / 只顯示飲料
  - 顯示收藏總數

- **收藏項目管理**:
  - 每個收藏項目顯示完整資訊（店名、地址、評分、電話等）
  - 可為每個收藏項目新增備註
  - 可儲存備註內容
  - 可移除不需要的收藏

### 3. 在瀏覽頁面加入收藏按鈕
- **店家列表頁面** (`/shops/`):
  - 每個店家卡片右上角有愛心收藏按鈕
  - 登入後才會顯示收藏按鈕
  - 點擊按鈕即可加入收藏
  - 已收藏的項目會顯示紅色愛心

### 4. 導航更新
- **首頁導航**:
  - 未登入：顯示「登入」和「註冊」按鈕
  - 已登入：顯示使用者名稱、「個人收藏」和「登出」連結

## 技術實作細節

### 資料庫模型
```python
# Favorite 模型（收藏）
- user: 使用者 (ForeignKey to User)
- favorite_type: 收藏類型（店家/飲料）
- tea_shop: 收藏的店家 (ForeignKey, nullable)
- drink: 收藏的飲料 (ForeignKey, nullable)
- notes: 備註 (TextField, nullable) - v3 新增
- created_at: 收藏時間
```

### API Endpoints
- `POST /favorites/add/` - 新增收藏 (AJAX)
- `POST /favorites/remove/` - 移除收藏 (AJAX)
- `POST /favorites/update-notes/` - 更新備註 (AJAX)
- `GET /favorites/check/` - 檢查是否已收藏 (AJAX)

### 前端互動
- 使用 jQuery 進行 AJAX 請求
- CSRF token 保護
- 即時更新收藏狀態
- 視覺回饋（愛心變色）

## 如何測試

### 1. 啟動伺服器
```bash
cd mysite
python manage.py runserver
```

### 2. 測試流程
1. 訪問 http://127.0.0.1:8000
2. 點擊「註冊」建立新帳號
3. 註冊成功後會自動登入
4. 點擊「瀏覽所有店家」
5. 在店家卡片右上角點擊愛心圖示加入收藏
6. 點擊右上角「個人收藏」查看收藏清單
7. 在收藏清單中可以：
   - 篩選店家/飲料
   - 新增備註
   - 儲存備註
   - 移除收藏

### 3. 測試密碼重設
1. 在登入頁面點擊「忘記密碼？」
2. 輸入註冊時使用的 Email（任意 email 即可，開發環境不會真的發送）
3. 查看終端機的輸出，會顯示密碼重設連結
4. 複製連結到瀏覽器並設定新密碼

## 所有功能已完成！✨

所有頁面都已加入收藏功能：
- [x] 店家列表頁面 (`/shops/`) - 可收藏店家
- [x] 推薦品項頁面 (`/drinks/`) - 可收藏飲料
- [x] 附近店家頁面 (`/nearby/`) - 可收藏店家
- [x] 店家詳細頁面 (`/shops/<id>/`) - 可同時收藏店家和該店的飲料

## 檔案結構

```
mysite/
├── polls/
│   ├── models.py           # 包含 Favorite 模型
│   ├── views.py            # 認證和收藏相關的 views
│   ├── migrations/
│   │   └── 0006_favorite_notes.py  # notes 欄位的遷移檔
│   └── templates/polls/
│       ├── home.html                # 更新了導航
│       ├── shop_list.html          # 加入了收藏按鈕
│       ├── favorites.html          # 收藏清單頁面
│       ├── register.html           # 註冊頁面
│       ├── login.html              # 登入頁面
│       └── password_reset*.html    # 密碼重設相關頁面
├── mysite/
│   ├── settings.py         # 新增 Email 和登入設定
│   └── urls.py             # 新增認證和收藏路由
└── db.sqlite3              # 資料庫（包含 Favorite 表）
```

## 注意事項

1. **Email 設定**: 目前使用 console backend，Email 內容會顯示在終端機而不是真的發送
2. **CSRF 保護**: 所有 AJAX POST 請求都需要 CSRF token
3. **登入要求**: 收藏功能需要使用者登入才能使用
4. **唯一性約束**: 同一使用者不能重複收藏同一個店家或飲料

## 生產環境部署建議

如要部署到生產環境，需要：
1. 設定真實的 Email 後端（如 Gmail SMTP 或 SendGrid）
2. 更改 `SECRET_KEY` 為隨機值
3. 將 `DEBUG` 設為 `False`
4. 設定 `ALLOWED_HOSTS`
5. 使用更強大的資料庫（如 PostgreSQL）
6. 設定靜態檔案伺服器
